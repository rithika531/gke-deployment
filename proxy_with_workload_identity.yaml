--- 
apiVersion: apps/v1
kind: Deployment
metadata: 
  name: test-environment-deployment
spec: 
  selector: 
    matchLabels: 
      app: app-project
  template: 
    metadata: 
      labels: 
        app: app-project
    spec: 
      containers: 
        - 
          env: 
            - 
              name: DB_USER
              valueFrom: 
                secretKeyRef: 
                  key: username
                  name: cloudsql-db-credentials
            - 
              name: DB_PASS
              valueFrom: 
                secretKeyRef: 
                  key: password
                  name: cloudsql-db-credentials
            - 
              name: DB_NAME
              value: postgres
          image: "us-central1-docker.pkg.dev/customer-n-test-service/hello-repo/test-app:v1"
          name: app-project
          ports: 
            - 
              containerPort: 9376
              protocol: TCP
        - 
          command: 
            - /cloud_sql_proxy
            - "-instances=customer-n-test-service:us-central1:testenvironment=tcp:5432"
          image: "gcr.io/cloudsql-docker/gce-proxy:latest"
          name: cloud-sql-proxy
          resources: 
            requests: 
              cpu: 200m
              memory: 32Mi
          securityContext: 
            runAsNonRoot: true
      serviceAccountName: testapp
