apiVersion: apps/v1
kind: Deployment
metadata: 
  name: prod-environment-deployment
spec: 
  selector: 
    matchLabels: 
      app: app-project
  template: 
    metadata: 
      labels: 
        app: app-project
    spec: 
      containers: 
        - 
          env: 
            - 
              name: DB_USER
              valueFrom: 
                secretKeyRef: 
                  key: username
                  name: cloudpsql-db-credentials 
            - 
              name: DB_PASS
              valueFrom: 
                secretKeyRef: 
                  key: password
                  name: cloudpsql-db-credentials
            - 
              name: DB_NAME
              value: postgres
          image: "us-central1-docker.pkg.dev/customer-n-prod-service-324106/hello-repo/hello-app:v1" 
          name: app-project 
        -  
          command: 
            - /cloud_sql_proxy
            - "-instances=customer-n-prod-service-324106:us-central1:psql-prod-instance=tcp:5432"
          image: "gcr.io/cloudsql-docker/gce-proxy:latest"
          name: cloud-sql-proxy
          resources: 
            requests: 
              cpu: 200m
              memory: 32Mi
          securityContext: 
            runAsNonRoot: true
      serviceAccountName: prodapp
